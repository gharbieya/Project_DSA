<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø´ØªÙ‚Ø§Ù‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ â€” Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ù…ÙˆØ±ÙÙˆÙ„ÙˆØ¬ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --ink:          #1a1208;
    --parchment:    #f5edd6;
    --parchment-dk: #e3d0a8;
    --gold:         #b8860b;
    --gold-light:   #d4a820;
    --gold-pale:    #fdf3d0;
    --copper:       #7a3b0e;
    --teal:         #17524f;
    --teal-light:   #1f7a74;
    --teal-pale:    #e0f2f1;
    --red:          #8b1a1a;
    --cream:        #fdfaf2;
    --shadow:       rgba(26,18,8,.15);
    --green:        #1a5c2a;
    --green-pale:   #e0f2e5;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Tajawal', sans-serif;
    background: var(--parchment); color: var(--ink); min-height: 100vh;
    background-image:
      radial-gradient(ellipse at 15% 0%,   rgba(184,134,11,.07) 0%, transparent 55%),
      radial-gradient(ellipse at 85% 100%, rgba(23,82,79,.07)   0%, transparent 55%),
      url("data:image/svg+xml,%3Csvg width='52' height='52' viewBox='0 0 52 52' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M26 1l3 8h8l-7 5 3 8-7-5-7 5 3-8-7-5h8z' fill='%23b8860b' fill-opacity='0.03'/%3E%3C/svg%3E");
  }

  /* â”€â”€ LOADING â”€â”€ */
  #loading-screen {
    position: fixed; inset: 0; background: var(--ink);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 9999; color: var(--gold-pale); gap: 1rem; transition: opacity .4s;
  }
  #loading-screen .ls-title { font-family: 'Amiri', serif; font-size: 2rem; color: var(--gold-pale); }
  #loading-screen .ls-sub   { font-size: .85rem; opacity: .5; }
  .spinner {
    width: 38px; height: 38px;
    border: 3px solid rgba(184,134,11,.2); border-top-color: var(--gold);
    border-radius: 50%; animation: spin .8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    background: linear-gradient(150deg, #1a1208 0%, #2e1a06 60%, #1a3330 100%);
    color: var(--gold-pale); padding: 1.8rem 2rem 1.4rem;
    position: relative; overflow: hidden;
    border-bottom: 3px solid var(--gold); box-shadow: 0 6px 30px var(--shadow);
  }
  header::before {
    content: ''; position: absolute; inset: 0;
    background: repeating-linear-gradient(-45deg, transparent, transparent 18px,
      rgba(184,134,11,.035) 18px, rgba(184,134,11,.035) 19px);
    pointer-events: none;
  }
  .header-inner {
    max-width: 1440px; margin: 0 auto;
    display: flex; align-items: center; justify-content: space-between;
    gap: 1.5rem; flex-wrap: wrap; position: relative;
  }
  .header-logo .title-ar {
    font-family: 'Amiri', serif;
    font-size: clamp(1.5rem, 3vw, 2.4rem); font-weight: 700;
    color: var(--gold-pale); text-shadow: 0 2px 14px rgba(184,134,11,.4); line-height: 1.1;
  }
  .header-logo .title-fr { font-size: .74rem; color: var(--gold-pale); opacity: .5; margin-top: .2rem; }
  .header-badges { display: flex; gap: .5rem; flex-wrap: wrap; }
  .hbadge {
    background: rgba(184,134,11,.18); border: 1px solid rgba(184,134,11,.35);
    border-radius: 20px; padding: .25rem .9rem;
    font-size: .77rem; color: var(--gold-pale); text-align: center;
  }
  .hbadge strong { color: var(--gold-light); font-size: .93rem; display: block; }

  /* â”€â”€ SEARCH BAR â”€â”€ */
  .search-section {
    background: linear-gradient(90deg, #1a1208, #2e1a06);
    padding: .65rem 2rem .95rem; border-bottom: 2px solid var(--gold);
  }
  .search-inner { max-width: 1440px; margin: 0 auto; }
  .search-box {
    display: flex; align-items: center; gap: .6rem;
    background: var(--cream); border: 2px solid var(--gold);
    border-radius: 40px; padding: .38rem .7rem .38rem 1.2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,.3);
  }
  .search-box input {
    flex: 1; border: none; background: transparent;
    font-family: 'Amiri', serif; font-size: 1.12rem;
    color: var(--ink); outline: none; direction: rtl;
  }
  .search-box input::placeholder { color: #aaa; }
  .search-icon { color: var(--gold); font-size: 1.05rem; }
  .search-tabs { display: flex; gap: .38rem; margin-top: .6rem; flex-wrap: wrap; }
  .stab {
    padding: .26rem .82rem; border: 1px solid rgba(255,255,255,.15);
    border-radius: 20px; background: transparent;
    color: rgba(255,255,255,.5); font-family: 'Tajawal', sans-serif;
    font-size: .76rem; cursor: pointer; transition: all .2s;
  }
  .stab:hover { background: rgba(184,134,11,.2); color: var(--gold-pale); }
  .stab.active { background: var(--gold); color: var(--ink); font-weight: 700; }

  /* â”€â”€ LAYOUT â”€â”€ */
  .page-body {
    max-width: 1440px; margin: 0 auto;
    padding: 1.1rem 1.1rem 3rem;
    display: grid; grid-template-columns: 265px 1fr 270px;
    gap: 1.05rem; align-items: start;
  }

  /* â”€â”€ PANELS â”€â”€ */
  .panel {
    background: var(--cream); border-radius: 14px;
    border: 1px solid var(--parchment-dk);
    box-shadow: 0 2px 14px var(--shadow); overflow: hidden;
  }
  .panel-head {
    padding: .62rem .95rem; font-family: 'Amiri', serif;
    font-size: .96rem; font-weight: 700;
    display: flex; align-items: center; gap: .38rem; color: #fff;
  }
  .panel-head.teal  { background: linear-gradient(90deg, var(--teal), var(--teal-light)); }
  .panel-head.gold  { background: linear-gradient(90deg, var(--copper), var(--gold-light)); }
  .panel-head.dark  { background: linear-gradient(90deg, var(--ink), #3a2508); }
  .panel-head.green { background: linear-gradient(90deg, var(--green), #267a3a); }
  .panel-body { padding: .72rem .88rem; }

  /* â”€â”€ SIDEBAR ROOTS â”€â”€ */
  .root-pill {
    display: flex; align-items: center; justify-content: space-between;
    padding: .36rem .62rem; border-radius: 8px; cursor: pointer;
    transition: all .14s; font-family: 'Amiri', serif;
    font-size: 1.06rem; direction: rtl;
  }
  .root-pill:hover   { background: var(--teal-pale); color: var(--teal); }
  .root-pill.selected { background: var(--teal); color: #fff; }
  .scroll-box { max-height: 250px; overflow-y: auto; }
  .scroll-box::-webkit-scrollbar { width: 4px; }
  .scroll-box::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 2px; }

  /* â”€â”€ VIEWS â”€â”€ */
  .view { display: none; }
  .view.active { display: block; animation: fadeUp .27s ease; }

  /* â”€â”€ DICT ENTRY â”€â”€ */
  .dict-entry-header {
    background: linear-gradient(135deg, var(--ink) 0%, #2e1a06 100%);
    border-radius: 14px 14px 0 0; padding: 1.7rem 2rem 1.3rem;
    text-align: center; color: var(--gold-pale); position: relative; overflow: hidden;
  }
  .dict-entry-header::before {
    content: ''; position: absolute; inset: 0;
    background: radial-gradient(ellipse at 50% 0%, rgba(184,134,11,.15), transparent 70%);
  }
  .dict-root-big {
    font-family: 'Amiri', serif; font-size: clamp(2.8rem, 6vw, 4.5rem);
    font-weight: 700; line-height: 1; color: #fff;
    text-shadow: 0 3px 20px rgba(184,134,11,.5); position: relative;
  }
  .dict-root-big .dash { color: var(--gold-light); font-size: 60%; vertical-align: middle; }
  .dict-root-subtitle { font-size: .8rem; color: var(--gold-pale); opacity: .6; margin-top: .32rem; position: relative; }
  .dict-root-tags { display: flex; gap: .38rem; justify-content: center; margin-top: .65rem; position: relative; flex-wrap: wrap; }
  .tag { display: inline-block; border-radius: 20px; padding: .16rem .72rem; font-size: .72rem; font-weight: 700; }
  .tag-gold  { background: var(--gold);       color: #fff; }
  .tag-teal  { background: var(--teal-light); color: #fff; }
  .dict-body { padding: 1.3rem; }
  .dict-section-title {
    font-family: 'Amiri', serif; font-size: 1.08rem; font-weight: 700;
    color: var(--teal); margin-bottom: .72rem;
    padding-bottom: .32rem; border-bottom: 2px solid var(--teal-pale);
    display: flex; align-items: center; gap: .42rem;
  }

  /* â”€â”€ SCHEME CARDS â”€â”€ */
  .scheme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(185px, 1fr)); gap: .72rem; }
  .scheme-card {
    background: var(--parchment); border: 1.5px solid var(--parchment-dk);
    border-radius: 10px; padding: .82rem .92rem;
    direction: rtl; transition: all .2s; cursor: pointer; position: relative;
  }
  .scheme-card:hover { border-color: var(--teal); background: var(--teal-pale); transform: translateY(-2px); box-shadow: 0 6px 20px var(--shadow); }
  .scheme-card .sc-word    { font-family: 'Amiri', serif; font-size: 1.42rem; font-weight: 700; color: var(--teal); display: block; }
  .scheme-card .sc-pattern { font-family: 'Amiri', serif; font-size: .8rem; color: var(--gold); margin-top: .1rem; display: block; }
  .scheme-card .sc-def     { font-size: .68rem; color: #666; margin-top: .35rem; line-height: 1.4; border-top: 1px solid var(--parchment-dk); padding-top: .35rem; }
  .scheme-card .sc-badge   { position: absolute; top: .42rem; left: .42rem; font-size: .58rem; background: var(--teal); color: #fff; border-radius: 10px; padding: .07rem .4rem; }

  /* â”€â”€ VALIDATION â”€â”€ */
  .val-result-yes { font-family: 'Amiri', serif; font-size: 2.7rem; font-weight: 700; color: var(--green); text-align: center; }
  .val-result-no  { font-family: 'Amiri', serif; font-size: 2.7rem; font-weight: 700; color: var(--red);   text-align: center; }

  /* â”€â”€ SIDEBAR RIGHT â”€â”€ */
  .pat-item {
    display: flex; align-items: flex-start; gap: .45rem;
    padding: .42rem .52rem; border-radius: 8px; cursor: pointer;
    transition: all .14s; direction: rtl; border-bottom: 1px solid var(--parchment-dk);
  }
  .pat-item:last-child { border-bottom: none; }
  .pat-item:hover { background: var(--gold-pale); }
  .pat-item .pi-name { font-family: 'Amiri', serif; font-size: 1.08rem; font-weight: 700; color: var(--teal); }
  .pat-item .pi-def  { font-size: .66rem; color: #777; line-height: 1.32; margin-top: .07rem; }

  /* â”€â”€ FORMS â”€â”€ */
  .form-group { margin-bottom: .78rem; }
  label.fl {
    display: block; font-size: .72rem; font-weight: 700; color: var(--teal);
    text-transform: uppercase; letter-spacing: .05em; margin-bottom: .26rem;
  }
  input[type="text"], select {
    width: 100%; padding: .48rem .82rem; border: 2px solid var(--parchment-dk);
    border-radius: 8px; background: var(--parchment); font-family: 'Amiri', serif;
    font-size: 1rem; color: var(--ink); direction: rtl; outline: none;
    transition: border-color .2s, box-shadow .2s;
  }
  input:focus, select:focus { border-color: var(--teal); box-shadow: 0 0 0 3px rgba(23,82,79,.12); background: #fff; }
  .hint { font-size: .68rem; color: #999; margin-top: .16rem; }

  /* â”€â”€ BUTTONS â”€â”€ */
  .btn {
    display: inline-flex; align-items: center; justify-content: center; gap: .36rem;
    padding: .48rem 1.2rem; border: none; border-radius: 8px; cursor: pointer;
    font-family: 'Tajawal', sans-serif; font-size: .85rem; font-weight: 700; transition: all .17s;
  }
  .btn-teal  { background: linear-gradient(135deg, var(--teal), var(--teal-light)); color: #fff; box-shadow: 0 2px 8px rgba(23,82,79,.3); }
  .btn-gold  { background: linear-gradient(135deg, var(--copper), var(--gold-light)); color: #fff; box-shadow: 0 2px 8px rgba(184,134,11,.3); }
  .btn-red   { background: linear-gradient(135deg, var(--red), #b83232); color: #fff; }
  .btn-ghost { background: var(--parchment); color: var(--ink); border: 1.5px solid var(--parchment-dk); }
  .btn:hover  { transform: translateY(-1px); filter: brightness(1.07); }
  .btn:active { transform: translateY(0); }
  .btn-full { width: 100%; }
  .btn-sm   { padding: .26rem .68rem; font-size: .74rem; }
  .btn-group { display: flex; gap: .42rem; flex-wrap: wrap; }

  /* â”€â”€ RESULT BOXES â”€â”€ */
  .rbox {
    border-radius: 10px; padding: .82rem .95rem; margin-top: .7rem;
    border-right: 4px solid var(--teal); background: var(--teal-pale);
    font-size: .88rem; direction: rtl; animation: fadeUp .22s ease;
  }
  .rbox.err  { border-color: var(--red);   background: #fde8e8; }
  .rbox.ok   { border-color: var(--green);  background: var(--green-pale); }
  .rbox.warn { border-color: var(--gold);   background: var(--gold-pale); }

  /* â”€â”€ CHECKBOX GRID â”€â”€ */
  .check-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: .26rem;
    max-height: 205px; overflow-y: auto;
    border: 1px solid var(--parchment-dk); border-radius: 8px;
    padding: .52rem; background: var(--parchment);
  }
  .check-grid label {
    display: flex; align-items: center; gap: .36rem;
    font-family: 'Amiri', serif; font-size: .96rem; cursor: pointer;
    padding: .1rem .26rem; border-radius: 5px; transition: background .1s; direction: rtl;
  }
  .check-grid label:hover { background: var(--gold-pale); }
  .check-grid input[type="checkbox"] { accent-color: var(--teal); width: 13px; height: 13px; }

  /* â”€â”€ FAMILY GRID â”€â”€ */
  .fam-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: .58rem; }
  .fam-item {
    background: var(--parchment); border: 1.5px solid var(--parchment-dk);
    border-radius: 10px; padding: .62rem .82rem;
    text-align: center; direction: rtl; cursor: pointer; transition: all .14s;
  }
  .fam-item:hover { border-color: var(--teal); background: var(--teal-pale); transform: translateY(-2px); }
  .fam-item .fi-word    { font-family: 'Amiri', serif; font-size: 1.32rem; color: var(--teal); font-weight: 700; display: block; }
  .fam-item .fi-pattern { font-size: .66rem; color: #888; font-family: 'Amiri', serif; margin-top: .16rem; display: block; }
  .fam-item .fi-def     { font-size: .61rem; color: #aaa; margin-top: .16rem; line-height: 1.3; }

  /* â”€â”€ EXPLORER HERO â”€â”€ */
  .exp-hero {
    text-align: center; padding: 1.4rem 1rem .95rem;
    background: linear-gradient(135deg, var(--ink), #2e1a06);
    border-radius: 12px; margin-bottom: 1.1rem; color: var(--gold-pale);
  }
  .exp-hero .root-display {
    font-family: 'Amiri', serif; font-size: clamp(2.8rem, 5.5vw, 4.2rem);
    font-weight: 700; color: #fff; line-height: 1;
  }
  .exp-hero .root-display .sep { color: var(--gold-light); font-size: 60%; vertical-align: middle; }
  .exp-hero .root-count { color: var(--gold-pale); opacity: .62; font-size: .83rem; margin-top: .38rem; }

  /* â”€â”€ DIVIDER â”€â”€ */
  .divider { height: 1px; background: linear-gradient(90deg, transparent, var(--gold), transparent); margin: .88rem 0; }

  /* â”€â”€ EMPTY â”€â”€ */
  .empty { text-align: center; padding: 1.8rem 1rem; color: #bbb; }
  .empty .ei { font-size: 2.3rem; display: block; margin-bottom: .38rem; }
  .empty p { font-family: 'Amiri', serif; font-size: .98rem; }

  /* â”€â”€ TOAST â”€â”€ */
  .toast {
    position: fixed; bottom: 2rem; left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--ink); color: var(--gold-pale);
    padding: .52rem 1.35rem; border-radius: 30px; font-size: .84rem;
    border: 1px solid var(--gold); z-index: 9999;
    transition: transform .28s; pointer-events: none; font-family: 'Amiri', serif;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* â”€â”€ ANIMATIONS â”€â”€ */
  @keyframes fadeUp { from { opacity:0; transform:translateY(9px); } to { opacity:1; transform:translateY(0); } }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 1080px) {
    .page-body { grid-template-columns: 240px 1fr; }
    .right-panel { display: none; }
  }
  @media (max-width: 680px) {
    .page-body { grid-template-columns: 1fr; }
    .left-panel { display: none; }
  }
</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loading-screen">
  <div class="ls-title">Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø´ØªÙ‚Ø§Ù‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ</div>
  <div class="spinner"></div>
  <div class="ls-sub">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø°ÙˆØ± ÙˆØ§Ù„Ø£ÙˆØ²Ø§Ù† Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øªâ€¦</div>
</div>

<div class="toast" id="toast"></div>

<!-- HEADER -->
<header>
  <div class="header-inner">
    <div class="header-logo">
      <div class="title-ar">Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø´ØªÙ‚Ø§Ù‚ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙˆØ±ÙÙˆÙ„ÙˆØ¬ÙŠ</div>
      <div class="title-fr">Moteur de Recherche Morphologique &amp; GÃ©nÃ©rateur de DÃ©rivation Arabe Â· ISI 1ING 2025â€“2026</div>
    </div>
    <div class="header-badges">
      <div class="hbadge"><strong id="stat-roots">â€“</strong>Ø¬Ø°Ø±</div>
      <div class="hbadge"><strong id="stat-patterns">â€“</strong>ÙˆØ²Ù†</div>
    </div>
  </div>
</header>

<!-- SEARCH + TABS -->
<div class="search-section">
  <div class="search-inner">
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input type="text" id="global-search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¬Ø°Ø± Ø£Ùˆ ÙˆØ²Ù†â€¦" autocomplete="off"
             onkeydown="if(event.key==='Enter') globalSearch(this.value)">
      <button class="btn btn-gold btn-sm" onclick="globalSearch(document.getElementById('global-search').value)">Ø¨Ø­Ø«</button>
    </div>
    <div class="search-tabs">
      <button class="stab active"  data-view="dict"     onclick="switchView(this)">ğŸ“– Ø§Ù„Ù‚Ø§Ù…ÙˆØ³</button>
      <button class="stab"         data-view="generate"  onclick="switchView(this)">âš™ï¸ ØªÙˆÙ„ÙŠØ¯ Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠ</button>
      <button class="stab"         data-view="validate"  onclick="switchView(this)">âœ… ØªØ­Ù‚Ù‚</button>
      <button class="stab"         data-view="explorer"  onclick="switchView(this)">ğŸ—ºï¸ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</button>
      <button class="stab"         data-view="manage"    onclick="switchView(this)">ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø©</button>
      <button class="stab"         data-view="schemes"   onclick="switchView(this)">ğŸ“ Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆØ²Ø§Ù†</button>
    </div>
  </div>
</div>

<!-- PAGE BODY -->
<div class="page-body">

  <!-- LEFT SIDEBAR -->
  <aside class="left-panel">
    <div class="panel" style="margin-bottom:.9rem;">
      <div class="panel-head teal">ğŸŒ³ Ø§Ù„Ø¬Ø°ÙˆØ±</div>
      <div class="panel-body" style="padding:.42rem .6rem;">
        <input type="text" id="root-filter" placeholder="ØªØµÙÙŠØ©â€¦"
               oninput="renderRootSidebar(this.value)"
               style="margin-bottom:.42rem;font-size:.86rem;padding:.3rem .6rem;">
        <div class="scroll-box" id="root-sidebar"></div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-head gold">â• Ø¥Ø¶Ø§ÙØ© Ø¬Ø°Ø± Ø³Ø±ÙŠØ¹</div>
      <div class="panel-body">
        <input type="text" id="quick-add-root" placeholder="Ùƒ-Øª-Ø¨" style="margin-bottom:.42rem;"
               onkeydown="if(event.key==='Enter') quickAddRoot()">
        <button class="btn btn-gold btn-full btn-sm" onclick="quickAddRoot()">Ø¥Ø¶Ø§ÙØ©</button>
        <div id="qar-msg"></div>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main>

    <!-- DICTIONARY -->
    <div class="view active" id="view-dict">
      <div id="dict-home">
        <div style="padding:1.1rem 0 .75rem;text-align:center;font-family:'Amiri',serif;font-size:.98rem;color:#999;">
          Ø§Ø®ØªØ± Ø¬Ø°Ø±Ù‹Ø§ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù†Ù‡
        </div>
        <div id="dict-featured"></div>
      </div>
      <div id="dict-entry" style="display:none;"></div>
    </div>

    <!-- GENERATE (selective only â€” no "full family" button here) -->
    <div class="view" id="view-generate">
      <div class="panel">
        <div class="panel-head teal">âš™ï¸ ØªÙˆÙ„ÙŠØ¯ Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø´ØªÙ‚Ø§Øª</div>
        <div class="panel-body">
          <div class="form-group">
            <label class="fl">Ø§Ù„Ø¬Ø°Ø± Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
            <input type="text" id="gen-root" placeholder="Ùƒ-Øª-Ø¨"
                   onkeydown="if(event.key==='Enter') doGenSelected()">
            <div class="hint">ØµÙŠØºØ©: Ø­Ø±Ù-Ø­Ø±Ù-Ø­Ø±Ù</div>
          </div>
          <div class="form-group">
            <label class="fl">Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
            <div class="check-grid" id="gen-patterns"></div>
          </div>
          <div class="btn-group" style="margin-top:.48rem;">
            <button class="btn btn-teal" onclick="doGenSelected()">âš¡ ØªÙˆÙ„ÙŠØ¯</button>
            <button class="btn btn-ghost btn-sm" onclick="checkAll()">â˜‘ Ø§Ù„ÙƒÙ„</button>
            <button class="btn btn-ghost btn-sm" onclick="uncheckAll()">â˜ Ø¥Ù„ØºØ§Ø¡</button>
          </div>
          <div id="gen-result"></div>
        </div>
      </div>
    </div>

    <!-- VALIDATE -->
    <div class="view" id="view-validate">
      <div class="panel">
        <div class="panel-head green">âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…ÙˆØ±ÙÙˆÙ„ÙˆØ¬ÙŠ</div>
        <div class="panel-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.95rem;">
            <div class="form-group">
              <label class="fl">Ø§Ù„Ø¬Ø°Ø± Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
              <input type="text" id="val-root" placeholder="Ùƒ-Øª-Ø¨">
            </div>
            <div class="form-group">
              <label class="fl">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ ÙØ­ØµÙ‡Ø§</label>
              <input type="text" id="val-word" placeholder="Ù…ÙƒØªÙˆØ¨"
                     onkeydown="if(event.key==='Enter') doValidate()">
            </div>
          </div>
          <button class="btn btn-teal btn-full" onclick="doValidate()">ğŸ” ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù†</button>
          <div id="val-result"></div>
        </div>
      </div>
    </div>

    <!-- EXPLORER (this is the only place full family generation lives) -->
    <div class="view" id="view-explorer">
      <div class="panel">
        <div class="panel-head gold">ğŸ—ºï¸ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ù„ØºÙˆÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</div>
        <div class="panel-body">
          <div style="display:flex;gap:.65rem;align-items:flex-end;flex-wrap:wrap;margin-bottom:.45rem;">
            <div class="form-group" style="flex:1;margin-bottom:0;">
              <label class="fl">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ø°Ø±</label>
              <select id="exp-root"></select>
            </div>
            <button class="btn btn-gold" onclick="doExplore()">ğŸŒ¿ Ø§Ø³ØªÙƒØ´Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªÙ‚Ø§Øª</button>
          </div>
          <div id="exp-result"></div>
        </div>
      </div>
    </div>

    <!-- MANAGE -->
    <div class="view" id="view-manage">
      <div class="panel">
        <div class="panel-head dark">ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø°ÙˆØ± ÙˆØ§Ù„Ø£ÙˆØ²Ø§Ù†</div>
        <div class="panel-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.15rem;">

            <!-- ROOTS -->
            <div>
              <div class="dict-section-title" style="font-size:.92rem;">ğŸŒ³ Ø§Ù„Ø¬Ø°ÙˆØ±</div>
              <div class="form-group">
                <label class="fl">Ø¥Ø¶Ø§ÙØ© Ø¬Ø°Ø±</label>
                <input type="text" id="mgmt-add-root" placeholder="Ùƒ-Øª-Ø¨"
                       onkeydown="if(event.key==='Enter') mgmtAddRoot()">
              </div>
              <button class="btn btn-teal btn-full" onclick="mgmtAddRoot()" style="margin-bottom:.65rem;">â• Ø¥Ø¶Ø§ÙØ©</button>
              <div class="form-group">
                <label class="fl">Ø­Ø°Ù Ø¬Ø°Ø±</label>
                <input type="text" id="mgmt-del-root" placeholder="Ùƒ-Øª-Ø¨">
              </div>
              <button class="btn btn-red btn-full" onclick="mgmtDelRoot()" style="margin-bottom:.65rem;">ğŸ—‘ Ø­Ø°Ù</button>
              <div class="form-group">
                <label class="fl">Ø¨Ø­Ø« Ø¹Ù† Ø¬Ø°Ø±</label>
                <input type="text" id="mgmt-search-root" placeholder="Ùƒ-Øª-Ø¨"
                       onkeydown="if(event.key==='Enter') mgmtSearchRoot()">
              </div>
              <button class="btn btn-ghost btn-full" onclick="mgmtSearchRoot()">ğŸ” Ø¨Ø­Ø«</button>
              <div id="mgmt-root-msg" style="margin-top:.45rem;"></div>
            </div>

            <!-- PATTERNS -->
            <div>
              <div class="dict-section-title" style="font-size:.92rem;">ğŸ“ Ø§Ù„Ø£ÙˆØ²Ø§Ù†</div>
              <div class="form-group">
                <label class="fl">Ø¥Ø¶Ø§ÙØ© ÙˆØ²Ù†</label>
                <input type="text" id="mgmt-add-pat" placeholder="Ù…ÙØ§Ø¹Ù„Ø©"
                       onkeydown="if(event.key==='Enter') mgmtAddPat()">
              </div>
              <button class="btn btn-teal btn-full" onclick="mgmtAddPat()" style="margin-bottom:.65rem;">â• Ø¥Ø¶Ø§ÙØ©</button>
              <div class="form-group">
                <label class="fl">Ø­Ø°Ù ÙˆØ²Ù†</label>
                <input type="text" id="mgmt-del-pat" placeholder="Ù…ÙØ¹Ø§Ù„">
              </div>
              <button class="btn btn-red btn-full" onclick="mgmtDelPat()">ğŸ—‘ Ø­Ø°Ù</button>
              <div id="mgmt-pat-msg" style="margin-top:.45rem;"></div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="dict-section-title" style="font-size:.9rem;">ÙƒÙ„ Ø§Ù„Ø¬Ø°ÙˆØ± ÙÙŠ Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©</div>
          <div id="mgmt-all-roots" style="display:flex;flex-wrap:wrap;gap:.28rem;"></div>
          <div class="divider"></div>
          <div class="dict-section-title" style="font-size:.9rem;">ÙƒÙ„ Ø§Ù„Ø£ÙˆØ²Ø§Ù† ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ¬Ø²Ø¦Ø©</div>
          <div id="mgmt-all-pats"  style="display:flex;flex-wrap:wrap;gap:.28rem;"></div>
        </div>
      </div>
    </div>

    <!-- SCHEMES ENCYCLOPEDIA -->
    <div class="view" id="view-schemes">
      <div class="panel">
        <div class="panel-head gold">ğŸ“ Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„ØµØ±ÙÙŠØ©</div>
        <div class="panel-body">
          <input type="text" id="scheme-filter" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£ÙˆØ²Ø§Ù†â€¦"
                 oninput="renderSchemesGrid(this.value)" style="margin-bottom:.88rem;">
          <div id="schemes-grid"></div>
        </div>
      </div>
    </div>

  </main>

  <!-- RIGHT SIDEBAR â€” PATTERNS -->
  <aside class="right-panel">
    <div class="panel">
      <div class="panel-head gold">ğŸ“ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„ØµØ±ÙÙŠØ©</div>
      <div class="panel-body" style="padding:.36rem .52rem;">
        <div class="scroll-box" style="max-height:570px;" id="pat-sidebar"></div>
      </div>
    </div>
  </aside>

</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ARABIC MORPHOLOGICAL ENGINE â€” JS Implementation
   Reads roots from ../Data/roots.txt & ../Data/patterns.txt
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â”€â”€ SCHEME DEFINITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SCHEME_DEFS = {
  'ÙØ§Ø¹Ù„':    { cat:'Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¹Ù„',                  def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„ÙØ¹Ù„',                              ex:['ÙƒØ§ØªØ¨','Ø¯Ø§Ø±Ø³','Ø¹Ø§Ù„Ù…','ÙØ§Ù‡Ù…'] },
  'Ù…ÙØ¹ÙˆÙ„':   { cat:'Ø§Ø³Ù… Ø§Ù„Ù…ÙØ¹ÙˆÙ„',                 def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ù…Ù† ÙˆÙ‚Ø¹ Ø¹Ù„ÙŠÙ‡ Ø§Ù„ÙØ¹Ù„',                         ex:['Ù…ÙƒØªÙˆØ¨','Ù…Ø¯Ø±ÙˆØ³','Ù…ÙÙ‡ÙˆÙ…'] },
  'ÙØ¹Ù‘Ø§Ù„':   { cat:'ØµÙŠØºØ© Ø§Ù„Ù…Ø¨Ø§Ù„ØºØ©',               def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ù„ØºØ© ÙˆØ§Ù„ÙƒØ«Ø±Ø© ÙÙŠ Ø§Ù„ÙØ¹Ù„',                 ex:['ÙƒØªÙ‘Ø§Ø¨','Ø¯Ø±Ù‘Ø§Ø³','Ø¹Ù„Ù‘Ø§Ù…'] },
  'Ù…ÙØ¹Ù„':    { cat:'Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† ÙˆØ§Ù„Ø²Ù…Ø§Ù†',           def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ù…ÙƒØ§Ù† ÙˆÙ‚ÙˆØ¹ Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ Ø²Ù…Ø§Ù†Ù‡',                 ex:['Ù…ÙƒØªØ¨','Ù…Ø¯Ø±Ø³Ø©','Ù…Ø¬Ù„Ø³'] },
  'ØªÙØ¹ÙŠÙ„':   { cat:'Ù…ØµØ¯Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„',                def:'Ù…ØµØ¯Ø± Ø§Ù„ÙØ¹Ù„ Ø§Ù„Ù…Ø¶Ø¹Ù‘Ù Ø¹Ù„Ù‰ ÙˆØ²Ù† ÙØ¹Ù‘Ù„',                  ex:['ØªÙƒØªÙŠØ¨','ØªØ¯Ø±ÙŠØ³','ØªØ¹Ù„ÙŠÙ…'] },
  'Ù…ÙØ§Ø¹Ù„Ø©':  { cat:'Ù…ØµØ¯Ø± Ø§Ù„Ù…ÙØ§Ø¹Ù„Ø©',               def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ ÙˆÙ‚ÙˆØ¹ Ø§Ù„ÙØ¹Ù„ Ø¨ÙŠÙ† Ø·Ø±ÙÙŠÙ† Ø¨Ø§Ù„ØªØ¨Ø§Ø¯Ù„',            ex:['Ù…ÙƒØ§ØªØ¨Ø©','Ù…Ø¯Ø§Ø±Ø³Ø©','Ù…Ø¹Ø§Ù…Ù„Ø©'] },
  'Ù…ÙØ¹Ø§Ù„':   { cat:'ØµÙŠØºØ© Ù…Ø¨Ø§Ù„ØºØ©',                 def:'ØµÙŠØºØ© Ù…Ø¨Ø§Ù„ØºØ© ØªØ¯Ù„ Ø¹Ù„Ù‰ ÙƒØ«Ø±Ø© ÙˆÙ‚ÙˆØ¹ Ø§Ù„ÙØ¹Ù„',              ex:['Ù…ÙƒØªØ§Ø¨','Ù…Ù‚Ø±Ø§Ø¡','Ù…ÙØ¹Ø§Ù„'] },
  'Ø§ÙØªØ¹Ø§Ù„':  { cat:'Ù…ØµØ¯Ø± Ø§Ù„Ø§ÙØªØ¹Ø§Ù„',               def:'Ù…ØµØ¯Ø± Ø§Ù„ÙØ¹Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¨Ø§Ù„Ø§ÙØªØ¹Ø§Ù„',                      ex:['Ø§ÙƒØªØªØ§Ø¨','Ø§Ø¬ØªÙ…Ø§Ø¹','Ø§Ø¹ØªØ±Ø§Ø¶'] },
  'Ø§ÙØªØ¹Ù„':   { cat:'ÙØ¹Ù„ Ø§Ù„Ø§ÙØªØ¹Ø§Ù„',                def:'ÙØ¹Ù„ Ù…Ø§Ø¶Ù ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø£Ùˆ Ø§Ù„ØªÙƒÙ„Ù‘Ù',              ex:['Ø§ÙƒØªØªØ¨','Ø§Ø¬ØªÙ…Ø¹','Ø§Ø¹ØªØ±Ø¶'] },
  'Ø§Ø³ØªÙØ¹Ø§Ù„': { cat:'Ù…ØµØ¯Ø± Ø§Ù„Ø§Ø³ØªÙØ¹Ø§Ù„',              def:'Ù…ØµØ¯Ø± Ø§Ù„ÙØ¹Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¨Ø§Ù„Ø§Ø³ØªÙØ¹Ø§Ù„ â€” ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨',     ex:['Ø§Ø³ØªÙƒØªØ§Ø¨','Ø§Ø³ØªØ¬Ù„Ø§Ø¨','Ø§Ø³ØªØ¹Ù…Ø§Ù„'] },
  'ÙØ¹ÙŠÙ„':    { cat:'ØµÙØ© Ù…Ø´Ø¨Ù‡Ø©',                   def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ ØµÙØ© Ø«Ø§Ø¨ØªØ© ÙÙŠ Ø§Ù„Ù…ÙˆØµÙˆÙ',                     ex:['ÙƒØ¨ÙŠØ±','ØµØºÙŠØ±','Ø¹Ù„ÙŠÙ…','Ø¬Ù…ÙŠÙ„'] },
  'ÙØ¹ÙˆÙ„':    { cat:'ØµÙŠØºØ© Ù…Ø¨Ø§Ù„ØºØ©',                 def:'ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ù„ØºØ© ÙÙŠ Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ø§Ù„ÙØ¹Ù„',                 ex:['Ø´Ø±ÙˆØ¨','Ø£ÙƒÙˆÙ„','Ø¶Ø±ÙˆØ¨'] },
  'Ø£ÙØ¹Ù„':    { cat:'Ø¥ÙØ¹Ø§Ù„ Ø£Ùˆ Ø£ÙØ¹Ù„ ØªÙØ¶ÙŠÙ„',          def:'ÙØ¹Ù„ Ø±Ø¨Ø§Ø¹ÙŠ Ù…Ø²ÙŠØ¯ Ø¨Ø§Ù„Ù‡Ù…Ø²Ø©ØŒ Ø£Ùˆ ØµÙŠØºØ© Ø§Ù„ØªÙØ¶ÙŠÙ„',          ex:['Ø£ÙƒØ±Ù…','Ø£Ø¹Ù„Ù…','Ø£ÙØ¶Ù„'] },
  'ØªÙØ§Ø¹Ù„':   { cat:'ÙØ¹Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„',                 def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ ÙˆÙ‚ÙˆØ¹ Ø§Ù„ÙØ¹Ù„ Ø¨ÙŠÙ† Ø£ÙƒØ«Ø± Ù…Ù† ÙØ§Ø¹Ù„',              ex:['ØªÙƒØ§ØªØ¨','ØªØ¯Ø§Ø±Ø³','ØªØ¹Ø§Ù„Ù…'] },
  'Ø§Ù†ÙØ¹Ø§Ù„':  { cat:'Ù…ØµØ¯Ø± Ø§Ù„Ø§Ù†ÙØ¹Ø§Ù„',               def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø·Ø§ÙˆØ¹Ø© ÙˆÙ‚Ø¨ÙˆÙ„ Ø£Ø«Ø± Ø§Ù„ÙØ¹Ù„',                 ex:['Ø§Ù†ÙƒØ³Ø§Ø±','Ø§Ù†ÙØªØ§Ø­','Ø§Ù†Ø¬Ø°Ø§Ø¨'] },
  'Ù…Ø³ØªÙØ¹Ù„':  { cat:'Ø§Ø³Ù… ÙØ§Ø¹Ù„ Ø§Ù„Ø§Ø³ØªÙØ¹Ø§Ù„',          def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ù…Ù† ÙŠØ·Ù„Ø¨ Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ ÙŠØ³Ø¹Ù‰ Ø¥Ù„ÙŠÙ‡',               ex:['Ù…Ø³ØªÙƒØªØ¨','Ù…Ø³ØªØ¹Ù…Ù„','Ù…Ø³ØªØ¬ÙŠØ¨'] },
  'ÙØ§Ø¹ÙˆÙ„':   { cat:'ØµÙŠØºØ© Ù…Ø¨Ø§Ù„ØºØ© Ù†Ø§Ø¯Ø±Ø©',           def:'ØµÙŠØºØ© Ù…Ø¨Ø§Ù„ØºØ© Ø¹Ù„Ù‰ ÙˆØ²Ù† ÙØ§Ø¹ÙˆÙ„',                        ex:['ÙØ§Ø±ÙˆÙ‚','Ø¬Ø§Ø³ÙˆØ³','Ù†Ø§Ù…ÙˆØ³'] },
  'ØªÙØ¹Ù‘Ù„':   { cat:'ÙØ¹Ù„ Ø§Ù„ØªÙØ¹Ù‘Ù„',                 def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒÙ„Ù ÙÙŠ Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ Ù‚Ø¨ÙˆÙ„Ù‡ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§',        ex:['ØªÙƒØªÙ‘Ø¨','ØªØ¹Ù„Ù‘Ù…','ØªØ£Ø¯Ù‘Ø¨'] },
  'Ø§ÙØ¹Ø§Ù„':   { cat:'Ù…ØµØ¯Ø± Ø§Ù„Ø¥ÙØ¹Ø§Ù„',                def:'Ù…ØµØ¯Ø± Ø§Ù„ÙØ¹Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¨Ø§Ù„Ù‡Ù…Ø²Ø©',                       ex:['Ø¥ÙƒØ±Ø§Ù…','Ø¥Ø¹Ù„Ø§Ù…','Ø¥Ø±Ø³Ø§Ù„'] },
  'ÙØ¹Ù„Ø§Ù†':   { cat:'ØµÙØ© ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨',         def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø­Ø±ÙƒØ© ÙˆØ§Ø¶Ø·Ø±Ø§Ø¨ ÙÙŠ Ø§Ù„Ù…ÙˆØµÙˆÙ',                  ex:['ØºØ¶Ø¨Ø§Ù†','Ø¹Ø·Ø´Ø§Ù†','ÙØ±Ø­Ø§Ù†'] },
  'ÙØ¹Ù„Ø©':    { cat:'Ø§Ø³Ù… Ù…Ø±Ø©',                     def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ ÙˆÙ‚ÙˆØ¹ Ø§Ù„ÙØ¹Ù„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©',                    ex:['Ø¶Ø±Ø¨Ø©','Ø£ÙƒÙ„Ø©','Ù†Ø¸Ø±Ø©'] },
  'ÙØ¹ÙŠÙ„Ø§Ù†':  { cat:'Ù…Ø«Ù†Ù‰ Ø§Ù„ØµÙØ© ÙØ¹ÙŠÙ„',             def:'Ù…Ø«Ù†Ù‰ ÙˆØ²Ù† ÙØ¹ÙŠÙ„',                                    ex:['ÙƒØ±ÙŠÙ…Ø§Ù†','Ø¹Ù„ÙŠÙ…Ø§Ù†','Ø¬Ù…ÙŠÙ„Ø§Ù†'] },
  'Ù…ÙØ§Ø¹Ù„':   { cat:'Ø¬Ù…Ø¹ ØªÙƒØ³ÙŠØ± Ù„Ù…ÙØ¹Ù„',             def:'Ø¬Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† Ø£Ùˆ Ø§Ù„Ø²Ù…Ø§Ù†',                         ex:['Ù…ÙƒØ§ØªØ¨','Ù…Ø¯Ø§Ø±Ø³','Ù…Ø³Ø§Ø¬Ø¯'] },
  'Ù…ÙØ¹Ù„Ø©':   { cat:'Ø§Ø³Ù… Ù…ÙƒØ§Ù† Ø£Ùˆ Ù…ØµØ¯Ø± Ù‡ÙŠØ¦Ø©',       def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ù…ÙƒØ§Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø´ÙŠØ¡ Ø¨ÙƒØ«Ø±Ø©',                    ex:['Ù…ÙƒØªØ¨Ø©','Ù…Ø¯Ø±Ø³Ø©','Ù…Ø²Ø±Ø¹Ø©'] },
  'Ù…ÙØ§Ø¹ÙŠÙ„':  { cat:'Ø¬Ù…Ø¹ ØªÙƒØ³ÙŠØ± Ù„Ù…ÙØ¹Ø§Ù„',            def:'Ø¬Ù…Ø¹ Ø§Ù„ØªÙƒØ³ÙŠØ± Ù„ØµÙŠØºØ© Ù…ÙØ¹Ø§Ù„',                          ex:['Ù…ÙØ§ØªÙŠØ­','Ù…ØµØ§Ø¨ÙŠØ­','Ù…Ù†Ø§Ø·ÙŠÙ‚'] },
  'ÙÙˆØ§Ø¹Ù„':   { cat:'Ø¬Ù…Ø¹ ØªÙƒØ³ÙŠØ± Ù„ÙØ§Ø¹Ù„Ø©',            def:'Ø¬Ù…Ø¹ Ø§Ù„ØªÙƒØ³ÙŠØ± Ù„Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø¤Ù†Ø«',                   ex:['ÙƒÙˆØ§ØªØ¨','Ø¯ÙˆØ§Ø±Ø³','Ø®ÙˆØ§Ø±Ø¬'] },
  'ÙÙˆØ§Ø¹ÙŠÙ„':  { cat:'Ø¬Ù…Ø¹ ØªÙƒØ³ÙŠØ± Ù„ÙØ§Ø¹ÙŠÙ„',            def:'Ø¬Ù…Ø¹ Ø§Ù„ØªÙƒØ³ÙŠØ± Ù„ØµÙŠØº ÙØ§Ø¹ÙŠÙ„',                           ex:['Ø¹ØµØ§ÙÙŠØ±','Ø£Ù†Ø§Ø¨ÙŠØ¨','Ø¹Ù†Ø§Ù‚ÙŠØ¯'] },
  'ÙØ¹Ø§Ù„Ø©':   { cat:'Ù…ØµØ¯Ø± ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙØ©',          def:'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙØ© Ø£Ùˆ Ø§Ù„Ù…Ù‡Ù†Ø©',                         ex:['ÙƒØªØ§Ø¨Ø©','Ø®ÙŠØ§Ø·Ø©','Ù†Ø¬Ø§Ø±Ø©'] },
  'ØªÙØ¹Ù„Ø©':   { cat:'Ù…ØµØ¯Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',         def:'Ù…ØµØ¯Ø± Ø¢Ø®Ø± Ù„Ø£ÙØ¹Ø§Ù„ Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„',          ex:['ØªÙƒÙ…Ù„Ø©','ØªÙˆØµÙŠØ©','ØªØ¬Ø²Ø¦Ø©'] },
};

// â”€â”€ NORMALIZATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DIACRITICS = /[\u064B-\u065F\u0670]/g;
const ALEF_MAP   = {'Ø¢':'Ø§','Ø£':'Ø§','Ø¥':'Ø§','Ù±':'Ø§'};
function norm(s)    { return s.replace(DIACRITICS,'').replace(/[Ø¢Ø£Ø¥Ù±]/g, c=>ALEF_MAP[c]||c).trim(); }
function isAr(c)    { return c >= '\u0621' && c <= '\u064A'; }
function compact(d) { return norm(d).replace(/-/g,''); }
function dashed(c)  { return c.split('').join('-'); }
function validateRoot(raw) {
  const n = norm(raw), l = n.replace(/-/g,'');
  if (!l)                             return 'Ø§Ù„Ø¬Ø°Ø± ÙØ§Ø±Øº';
  if (!l.split('').every(isAr))       return 'ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·';
  if (l.length !== 3)                 return 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ø¬Ø°Ø± Ø¹Ù„Ù‰ 3 Ø­Ø±ÙˆÙ ÙÙ‚Ø·';
  if (n.split('-').length - 1 !== 2)  return 'Ø§Ù„ØµÙŠØºØ© Ø§Ù„ØµØ­ÙŠØ­Ø©: Ø­Ø±Ù-Ø­Ø±Ù-Ø­Ø±Ù  (Ù…Ø«Ø§Ù„: Ùƒ-Øª-Ø¨)';
  return null;
}

// â”€â”€ DATA STORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const roots    = {};  // compact3 -> { derived:{} }
const patterns = {};  // normPat  -> displayForm

// â”€â”€ DYNAMIC LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchText(path) {
  try { const r = await fetch(path); return r.ok ? r.text() : null; }
  catch { return null; }
}

async function initData() {
  const [rootsTxt, patsTxt] = await Promise.all([
    fetchText('../Data/roots.txt'),
    fetchText('../Data/patterns.txt'),
  ]);

  // â”€â”€ Load roots â”€â”€
  const rootLines = rootsTxt
    ? rootsTxt.split('\n')
    : ['Ùƒ-Øª-Ø¨','Ø¯-Ø±-Ø³','Ø¹-Ù„-Ù…','Ù-Ù‡-Ù…','Ù‚-Ø±-Ø£','Ø³-Ù…-Ø¹','Ø°-Ù‡-Ø¨','Ø¬-Ù„-Ø³','Ø­-Ø³-Ø¨','Ø¹-Ù…-Ù„',
       'Ù-Ø¹-Ù„','Øµ-Ù†-Ø¹','Ù„-Ø¹-Ø¨','Ø±-Ùƒ-Ø¨','Ø´-Ø±-Ø¨','Ø£-Ùƒ-Ù„','Ù†-Ø²-Ù„','Ø±-Ø¬-Ø¹','Ø®-Ø±-Ø¬','Ø¯-Ø®-Ù„',
       'Ù-Øª-Ø­','Ø­-Ù…-Ù„','Ùˆ-Ø¬-Ø¯'];
  rootLines.forEach(line => {
    const r = line.trim();
    if (r && !validateRoot(r)) { const c = compact(r); if (!roots[c]) roots[c] = { derived:{} }; }
  });

  // â”€â”€ Load patterns â”€â”€
  const patLines = patsTxt
    ? patsTxt.split('\n')
    : ['ÙØ§Ø¹Ù„','Ù…ÙØ¹ÙˆÙ„','ÙØ¹Ù‘Ø§Ù„','Ù…ÙØ¹Ù„','ØªÙØ¹ÙŠÙ„','Ù…ÙØ§Ø¹Ù„Ø©','Ù…ÙØ¹Ø§Ù„','Ø§ÙØªØ¹Ø§Ù„','Ø§ÙØªØ¹Ù„',
       'Ø§Ø³ØªÙØ¹Ø§Ù„','ÙØ¹ÙŠÙ„','ÙØ¹ÙˆÙ„','Ø£ÙØ¹Ù„','ØªÙØ§Ø¹Ù„','Ø§Ù†ÙØ¹Ø§Ù„','Ù…Ø³ØªÙØ¹Ù„','ÙØ§Ø¹ÙˆÙ„','ØªÙØ¹Ù‘Ù„',
       'Ø§ÙØ¹Ø§Ù„','ÙØ¹Ù„Ø§Ù†','ÙØ¹Ù„Ø©','ÙØ¹ÙŠÙ„Ø§Ù†','Ù…ÙØ§Ø¹Ù„','Ù…ÙØ¹Ù„Ø©','Ù…ÙØ§Ø¹ÙŠÙ„','ÙÙˆØ§Ø¹Ù„','ÙÙˆØ§Ø¹ÙŠÙ„','ÙØ¹Ø§Ù„Ø©','ØªÙØ¹Ù„Ø©'];
  patLines.forEach(line => {
    const p = line.trim();
    if (p) { const n = norm(p); if (!patterns[n]) patterns[n] = p; }
  });

  // Dismiss loading screen
  const ls = document.getElementById('loading-screen');
  ls.style.opacity = '0';
  setTimeout(() => ls.style.display = 'none', 380);

  // Boot UI
  updateStats();
  renderAll();
  renderGenPatterns();
  populateExpSelect();
  renderFeatured();
  renderSchemesGrid('');
}

// â”€â”€ ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function derive(rawRoot, normPat) {
  if (validateRoot(rawRoot)) return null;
  const parts = norm(rawRoot).split('-');
  if (parts.length !== 3) return null;
  const [f, a, l] = parts;
  return normPat.split('').map(c => c==='Ù'?f : c==='Ø¹'?a : c==='Ù„'?l : c).join('');
}

function genFamily(rawRoot) {
  const cmp = compact(rawRoot);
  if (!roots[cmp]) return null;
  return Object.keys(patterns).reduce((acc, np) => {
    const word = derive(rawRoot, np);
    if (word) acc.push({ np, display: patterns[np], word });
    return acc;
  }, []);
}

function doValidateWord(rawRoot, rawWord) {
  const cmp = compact(rawRoot);
  if (!roots[cmp]) return { result:'NON', pattern:null };
  const nw = norm(rawWord);
  for (const np of Object.keys(patterns)) {
    const w = derive(rawRoot, np);
    if (w && norm(w) === nw) return { result:'OUI', pattern:np, display:patterns[np] };
  }
  return { result:'NON', pattern:null };
}

// â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats() {
  document.getElementById('stat-roots').textContent    = Object.keys(roots).length;
  document.getElementById('stat-patterns').textContent = Object.keys(patterns).length;
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg, ms=2200) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), ms);
}

// â”€â”€ VIEW SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentView = 'dict';
function switchView(btn) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.stab').forEach(b => b.classList.remove('active'));
  const name = btn.dataset.view;
  document.getElementById('view-' + name).classList.add('active');
  btn.classList.add('active');
  currentView = name;
  if (name === 'manage')   renderMgmtAll();
  if (name === 'schemes')  renderSchemesGrid(document.getElementById('scheme-filter').value);
  if (name === 'generate') renderGenPatterns();
  if (name === 'explorer') populateExpSelect();
}
function switchToView(name) {
  const btn = document.querySelector(`.stab[data-view="${name}"]`);
  if (btn) switchView(btn);
}

// â”€â”€ GLOBAL SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function globalSearch(query) {
  if (!query.trim()) return;
  const n = norm(query);
  const matchRoot = Object.keys(roots).find(c => c.includes(n));
  if (matchRoot) { openDictEntry(dashed(matchRoot)); return; }
  const matchPat = Object.keys(patterns).find(np => np.includes(n) || norm(patterns[np]).includes(n));
  if (matchPat) {
    switchToView('schemes');
    setTimeout(() => {
      document.getElementById('scheme-filter').value = patterns[matchPat];
      renderSchemesGrid(patterns[matchPat]);
    }, 50);
    return;
  }
  toast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€: ' + query);
}

// â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRootSidebar(filter) {
  filter = filter || '';
  const el  = document.getElementById('root-sidebar');
  const all = Object.keys(roots).map(c => dashed(c)).sort();
  const fn  = norm(filter);
  const fil = fn ? all.filter(r => compact(r).includes(fn)) : all;
  if (!fil.length) { el.innerHTML = '<div class="empty" style="padding:.8rem"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ø°ÙˆØ±</p></div>'; return; }
  el.innerHTML = fil.map(r =>
    `<div class="root-pill" onclick="openDictEntry('${r}')" id="rp-${compact(r)}">${r}</div>`
  ).join('');
}

function renderPatSidebar() {
  document.getElementById('pat-sidebar').innerHTML =
    Object.keys(patterns).map(np => {
      const d  = patterns[np];
      const df = SCHEME_DEFS[norm(d)] || SCHEME_DEFS[d] || {};
      return `<div class="pat-item" onclick="switchToView('schemes')">
        <div>
          <div class="pi-name">${d}</div>
          <div class="pi-def">${df.cat || ''}</div>
        </div>
      </div>`;
    }).join('');
}

function renderAll() {
  renderRootSidebar(document.getElementById('root-filter')?.value || '');
  renderPatSidebar();
}

// â”€â”€ DICTIONARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFeatured() {
  document.getElementById('dict-featured').innerHTML =
    Object.keys(roots).map(c => dashed(c)).slice(0, 4).map(r => miniRootCard(r)).join('');
}

function miniRootCard(dashedRoot) {
  const family  = genFamily(dashedRoot) || [];
  const letters = dashedRoot.split('-');
  const preview = family.slice(0, 6).map(f =>
    `<div class="fam-item" style="padding:.42rem .6rem;" onclick="openDictEntry('${dashedRoot}')">
       <span class="fi-word">${f.word}</span>
       <span class="fi-pattern">${f.display}</span>
     </div>`
  ).join('');
  return `
    <div style="background:var(--cream);border:1px solid var(--parchment-dk);border-radius:14px;margin-bottom:.85rem;overflow:hidden;">
      <div style="background:linear-gradient(90deg,var(--ink),#2e1a06);padding:.62rem 1.05rem;
                  display:flex;align-items:center;justify-content:space-between;cursor:pointer;"
           onclick="openDictEntry('${dashedRoot}')">
        <span style="font-family:'Amiri',serif;font-size:1.65rem;color:#fff;">
          ${letters[0]}<span style="color:var(--gold-light);font-size:.9rem;"> â€“ </span>${letters[1]}<span style="color:var(--gold-light);font-size:.9rem;"> â€“ </span>${letters[2]}
        </span>
        <span class="tag tag-gold">${family.length} Ù…Ø´ØªÙ‚</span>
      </div>
      <div style="padding:.65rem .88rem;display:flex;flex-wrap:wrap;gap:.32rem;">${preview}</div>
    </div>`;
}

function openDictEntry(dashedRoot) {
  document.querySelectorAll('.root-pill').forEach(p => p.classList.remove('selected'));
  const rp = document.getElementById('rp-' + compact(dashedRoot));
  if (rp) rp.classList.add('selected');
  if (currentView !== 'dict') switchToView('dict');
  document.getElementById('dict-home').style.display  = 'none';
  document.getElementById('dict-entry').style.display = 'block';

  const family  = genFamily(dashedRoot) || [];
  const letters = dashedRoot.split('-');

  const schemeCards = family.map(f => {
    const df = SCHEME_DEFS[norm(f.display)] || SCHEME_DEFS[f.display] || {};
    return `<div class="scheme-card" onclick="switchToView('schemes')">
      <span class="sc-badge">${df.cat || 'ÙˆØ²Ù†'}</span>
      <span class="sc-word">${f.word}</span>
      <span class="sc-pattern">${f.display}</span>
      ${df.def ? `<div class="sc-def">${df.def}</div>` : ''}
    </div>`;
  }).join('');

  document.getElementById('dict-entry').innerHTML = `
    <div class="dict-entry-header">
      <div class="dict-root-big">
        ${letters[0]}<span class="dash"> â€“ </span>${letters[1]}<span class="dash"> â€“ </span>${letters[2]}
      </div>
      <div class="dict-root-subtitle">${dashedRoot} Â· Ø¬Ø°Ø± Ø«Ù„Ø§Ø«ÙŠ</div>
      <div class="dict-root-tags">
        <span class="tag tag-teal">${family.length} Ù…Ø´ØªÙ‚</span>
        <span class="tag tag-gold">BST âœ“</span>
      </div>
    </div>
    <div class="dict-body">
      <button class="btn btn-ghost btn-sm" onclick="backToHome()" style="margin-bottom:.95rem;">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
      <div class="dict-section-title">Ø§Ù„Ù…Ø´ØªÙ‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„ØµØ±ÙÙŠØ©</div>
      <div class="scheme-grid">${schemeCards || '<div class="empty"><span class="ei">ğŸ“­</span><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ²Ø§Ù† Ù…Ø­Ù…Ù‘Ù„Ø©</p></div>'}</div>
    </div>`;
}

function backToHome() {
  document.getElementById('dict-home').style.display  = 'block';
  document.getElementById('dict-entry').style.display = 'none';
  document.querySelectorAll('.root-pill').forEach(p => p.classList.remove('selected'));
}

// â”€â”€ GENERATE (selective) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderGenPatterns() {
  document.getElementById('gen-patterns').innerHTML =
    Object.keys(patterns).map(np =>
      `<label><input type="checkbox" value="${np}" checked> ${patterns[np]}</label>`
    ).join('');
}
function checkAll()   { document.querySelectorAll('#gen-patterns input').forEach(cb => cb.checked = true); }
function uncheckAll() { document.querySelectorAll('#gen-patterns input').forEach(cb => cb.checked = false); }

function doGenSelected() {
  const rawRoot = document.getElementById('gen-root').value.trim();
  const err = validateRoot(rawRoot);
  if (err) { document.getElementById('gen-result').innerHTML = rbox(err,'err'); return; }
  if (!roots[compact(rawRoot)]) { document.getElementById('gen-result').innerHTML = rbox('Ø§Ù„Ø¬Ø°Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø´Ø¬Ø±Ø© â€” Ø£Ø¶ÙÙ‡ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.','err'); return; }
  const checked = [...document.querySelectorAll('#gen-patterns input:checked')].map(cb => cb.value);
  if (!checked.length) { document.getElementById('gen-result').innerHTML = rbox('Ø§Ø®ØªØ± ÙˆØ²Ù†Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.','err'); return; }
  const items = checked.map(np => {
    const word = derive(rawRoot, np);
    const d    = patterns[np];
    const df   = SCHEME_DEFS[norm(d)] || SCHEME_DEFS[d] || {};
    return word
      ? `<div class="fam-item"><span class="fi-word">${word}</span><span class="fi-pattern">${d}</span><div class="fi-def">${df.def||''}</div></div>`
      : `<div class="fam-item" style="opacity:.3"><span class="fi-word">â€”</span><span class="fi-pattern">${d}</span></div>`;
  }).join('');
  document.getElementById('gen-result').innerHTML = `
    <div style="margin-top:.88rem;">
      <div class="dict-section-title" style="font-size:.9rem;">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬Ø°Ø± ${rawRoot} (${checked.length} ÙˆØ²Ù†)</div>
      <div class="fam-grid">${items}</div>
    </div>`;
}

// â”€â”€ VALIDATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doValidate() {
  const rawRoot = document.getElementById('val-root').value.trim();
  const rawWord = document.getElementById('val-word').value.trim();
  const err = validateRoot(rawRoot);
  if (err) { document.getElementById('val-result').innerHTML = rbox(err,'err'); return; }
  if (!rawWord) { document.getElementById('val-result').innerHTML = rbox('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ ÙØ­ØµÙ‡Ø§','err'); return; }
  if (!roots[compact(rawRoot)]) { document.getElementById('val-result').innerHTML = rbox('Ø§Ù„Ø¬Ø°Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø´Ø¬Ø±Ø©','err'); return; }
  const res = doValidateWord(rawRoot, rawWord);
  if (res.result === 'OUI') {
    const df = SCHEME_DEFS[norm(res.display||'')] || SCHEME_DEFS[res.display||''] || {};
    document.getElementById('val-result').innerHTML = `
      <div class="rbox ok" style="text-align:center;padding:1.35rem;">
        <div class="val-result-yes">Ù†Ø¹Ù… âœ…</div>
        <div style="margin-top:.65rem;font-size:.9rem;">
          Ø§Ù„ÙƒÙ„Ù…Ø© <strong style="font-family:'Amiri',serif;font-size:1.12rem;">${rawWord}</strong>
          Ù…Ø´ØªÙ‚Ø© Ù…Ù† Ø§Ù„Ø¬Ø°Ø± <strong>${rawRoot}</strong>
        </div>
        <div style="margin-top:.42rem;">
          Ø¹Ù„Ù‰ ÙˆØ²Ù† <span style="font-family:'Amiri',serif;font-size:1.2rem;color:var(--teal);">${res.display||res.pattern}</span>
          ${df.cat ? `<span class="tag tag-gold" style="margin-right:.32rem;">${df.cat}</span>` : ''}
        </div>
        ${df.def ? `<div style="margin-top:.45rem;font-size:.8rem;color:#555;">${df.def}</div>` : ''}
      </div>`;
  } else {
    document.getElementById('val-result').innerHTML = `
      <div class="rbox err" style="text-align:center;padding:1.35rem;">
        <div class="val-result-no">Ù„Ø§ âŒ</div>
        <div style="margin-top:.48rem;">Ø§Ù„ÙƒÙ„Ù…Ø© <strong>${rawWord}</strong> Ù„Ø§ ØªÙ†ØªÙ…ÙŠ Ù…ÙˆØ±ÙÙˆÙ„ÙˆØ¬ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø°Ø± <strong>${rawRoot}</strong></div>
      </div>`;
  }
}

// â”€â”€ EXPLORER (generate full family) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populateExpSelect() {
  const sel = document.getElementById('exp-root');
  const cur = sel.value;
  sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø¬Ø°Ø±Ù‹Ø§ --</option>';
  Object.keys(roots).map(c => dashed(c)).sort().forEach(r => {
    const o = document.createElement('option');
    o.value = r; o.textContent = r; sel.appendChild(o);
  });
  if (cur) sel.value = cur;
}

function doExplore() {
  const r = document.getElementById('exp-root').value;
  if (!r) { toast('âš ï¸ Ø§Ø®ØªØ± Ø¬Ø°Ø±Ù‹Ø§ Ø£ÙˆÙ„Ø§Ù‹'); return; }
  const family  = genFamily(r) || [];
  const letters = r.split('-');
  const items = family.map(f => {
    const df = SCHEME_DEFS[norm(f.display)] || SCHEME_DEFS[f.display] || {};
    return `<div class="fam-item" onclick="switchToView('schemes')">
      <span class="fi-word">${f.word}</span>
      <span class="fi-pattern">${f.display}</span>
      <div class="fi-def">${df.def || ''}</div>
    </div>`;
  }).join('');
  document.getElementById('exp-result').innerHTML = `
    <div class="exp-hero">
      <div class="root-display">
        ${letters[0]}<span class="sep"> â€“ </span>${letters[1]}<span class="sep"> â€“ </span>${letters[2]}
      </div>
      <div class="root-count">${family.length} Ù…Ø´ØªÙ‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„ØµØ±ÙÙŠØ©</div>
    </div>
    <div class="fam-grid">${items}</div>`;
}

// â”€â”€ MANAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mgmtAddRoot() {
  const raw = document.getElementById('mgmt-add-root').value.trim();
  const err = validateRoot(raw);
  if (err) { document.getElementById('mgmt-root-msg').innerHTML = rbox(err,'err'); return; }
  const cmp = compact(raw);
  if (roots[cmp]) { document.getElementById('mgmt-root-msg').innerHTML = rbox('Ø§Ù„Ø¬Ø°Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.','warn'); return; }
  roots[cmp] = { derived:{} };
  document.getElementById('mgmt-root-msg').innerHTML = rbox(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø°Ø± ${raw}`,'ok');
  document.getElementById('mgmt-add-root').value = '';
  renderAll(); renderMgmtAll(); populateExpSelect(); updateStats(); toast('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø°Ø±');
}

function mgmtDelRoot() {
  const raw = document.getElementById('mgmt-del-root').value.trim();
  if (!raw) { document.getElementById('mgmt-root-msg').innerHTML = rbox('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¬Ø°Ø± Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡.','err'); return; }
  const cmp = compact(raw);
  if (!roots[cmp]) { document.getElementById('mgmt-root-msg').innerHTML = rbox('Ø§Ù„Ø¬Ø°Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.','err'); return; }
  delete roots[cmp];
  document.getElementById('mgmt-root-msg').innerHTML = rbox(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ø°Ø± ${raw}`,'ok');
  document.getElementById('mgmt-del-root').value = '';
  renderAll(); renderMgmtAll(); populateExpSelect(); updateStats(); toast('ğŸ—‘ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ø°Ø±');
}

function mgmtSearchRoot() {
  const raw = document.getElementById('mgmt-search-root').value.trim();
  const cmp = compact(raw);
  document.getElementById('mgmt-root-msg').innerHTML = roots[cmp]
    ? rbox('âœ… Ø§Ù„Ø¬Ø°Ø± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©','ok')
    : rbox('âŒ Ø§Ù„Ø¬Ø°Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø´Ø¬Ø±Ø©.','err');
}

function mgmtAddPat() {
  const raw = document.getElementById('mgmt-add-pat').value.trim();
  const np  = norm(raw);
  if (!np || np.length < 4 || !np.includes('Ù') || !np.includes('Ø¹') || !np.includes('Ù„')) {
    document.getElementById('mgmt-pat-msg').innerHTML = rbox('ÙˆØ²Ù† ØºÙŠØ± ØµØ§Ù„Ø­ â€” ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù ÙˆØ¹ ÙˆÙ„ (4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„).','err'); return;
  }
  if (patterns[np]) { document.getElementById('mgmt-pat-msg').innerHTML = rbox('Ø§Ù„ÙˆØ²Ù† Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.','warn'); return; }
  patterns[np] = raw;
  document.getElementById('mgmt-pat-msg').innerHTML = rbox(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ²Ù† ${raw}`,'ok');
  document.getElementById('mgmt-add-pat').value = '';
  renderAll(); renderMgmtAll(); renderGenPatterns(); updateStats(); toast('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ²Ù†');
}

function mgmtDelPat() {
  const raw = document.getElementById('mgmt-del-pat').value.trim();
  const np  = norm(raw);
  if (!patterns[np]) { document.getElementById('mgmt-pat-msg').innerHTML = rbox('Ø§Ù„ÙˆØ²Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.','err'); return; }
  delete patterns[np];
  document.getElementById('mgmt-pat-msg').innerHTML = rbox(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ²Ù† ${raw}`,'ok');
  document.getElementById('mgmt-del-pat').value = '';
  renderAll(); renderMgmtAll(); renderGenPatterns(); updateStats(); toast('ğŸ—‘ ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ²Ù†');
}

function renderMgmtAll() {
  document.getElementById('mgmt-all-roots').innerHTML =
    Object.keys(roots).map(c => dashed(c)).sort().map(r =>
      `<span onclick="openDictEntry('${r}')"
             style="cursor:pointer;background:var(--parchment);border:1px solid var(--parchment-dk);
                    border-radius:7px;padding:.2rem .62rem;font-family:'Amiri',serif;font-size:.96rem;"
             onmouseover="this.style.background='var(--teal-pale)'"
             onmouseout="this.style.background='var(--parchment)'">${r}</span>`
    ).join('');
  document.getElementById('mgmt-all-pats').innerHTML =
    Object.keys(patterns).map(np =>
      `<span onclick="switchToView('schemes')"
             style="cursor:pointer;background:var(--gold-pale);border:1px solid var(--parchment-dk);
                    border-radius:7px;padding:.2rem .62rem;font-family:'Amiri',serif;font-size:.96rem;">${patterns[np]}</span>`
    ).join('');
}

// â”€â”€ QUICK ADD (sidebar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function quickAddRoot() {
  const raw = document.getElementById('quick-add-root').value.trim();
  const err = validateRoot(raw);
  if (err) { document.getElementById('qar-msg').innerHTML = `<div style="font-size:.7rem;color:var(--red);margin-top:.25rem;">${err}</div>`; return; }
  const cmp = compact(raw);
  if (roots[cmp]) { document.getElementById('qar-msg').innerHTML = `<div style="font-size:.7rem;color:var(--gold);margin-top:.25rem;">Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„</div>`; return; }
  roots[cmp] = { derived:{} };
  document.getElementById('quick-add-root').value = '';
  document.getElementById('qar-msg').innerHTML = `<div style="font-size:.7rem;color:var(--green);margin-top:.25rem;">âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©</div>`;
  renderAll(); populateExpSelect(); updateStats(); toast('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø°Ø±');
}

// â”€â”€ SCHEMES ENCYCLOPEDIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSchemesGrid(filter) {
  const el   = document.getElementById('schemes-grid');
  const fn   = norm(filter || '');
  const ps   = Object.keys(patterns);
  const show = fn ? ps.filter(np => np.includes(fn) || norm(patterns[np]).includes(fn)) : ps;
  if (!show.length) { el.innerHTML = '<div class="empty"><span class="ei">ğŸ“­</span><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p></div>'; return; }
  el.innerHTML = `<div class="scheme-grid">` + show.map(np => {
    const d  = patterns[np];
    const df = SCHEME_DEFS[norm(d)] || SCHEME_DEFS[d] || {};
    const exHtml = (df.ex||[]).map(e =>
      `<span style="background:var(--teal);color:#fff;border-radius:6px;padding:.18rem .65rem;font-family:'Amiri',serif;font-size:.9rem;">${e}</span>`
    ).join('');
    return `<div class="scheme-card" style="cursor:default;padding:.95rem 1.05rem;">
      <span class="sc-badge">${df.cat || 'ÙˆØ²Ù†'}</span>
      <span class="sc-word" style="font-size:1.9rem;">${d}</span>
      <div style="margin-top:.45rem;">
        <div style="font-size:.7rem;color:var(--gold);font-weight:700;margin-bottom:.15rem;">${df.cat || 'ÙˆØ²Ù† ØµØ±ÙÙŠ'}</div>
        <div style="font-size:.78rem;color:#444;line-height:1.6;">${df.def || 'ÙˆØ²Ù† ØµØ±ÙÙŠ Ø¹Ø±Ø¨ÙŠ ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ø´ØªÙ‚Ø§Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø§Øª.'}</div>
        ${df.ex ? `<div style="display:flex;flex-wrap:wrap;gap:.28rem;margin-top:.52rem;">${exHtml}</div>` : ''}
      </div>
    </div>`;
  }).join('') + `</div>`;
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rbox(msg, type) {
  const cls = {err:'err', ok:'ok', warn:'warn'}[type] || '';
  return `<div class="rbox ${cls}">${msg}</div>`;
}

// â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initData();
</script>
</body>
</html>
